name: goae
version: 0.2.0
inherits: michilu/goapp@1.9.35
type : main
platform : ubuntu@12.04
description : golang
keywords:
  - golang
  - appengine
  - nodejs
  - go
packages :
  - nodejs@4.3.1
script : |
  curl -sL https://deb.nodesource.com/setup_4.x | sudo -E bash -
  sudo apt-get install -y nodejs

box-detect:
  priority : 900
  version :
  detect:
    - files:
      - .godir

default-build:
  python:
    priority : 50
    detect:
      - default: true
    text-to-append: |
      # Build definition
      build:
        # The steps that will be executed on build
        steps:
          - script:
              name: setup golang
              code: |-
                if test "${WERCKER_GIT_REPOSITORY+set}" == set; then mkdir -p "$GOPATH/src/$WERCKER_GIT_DOMAIN/$WERCKER_GIT_OWNER/$WERCKER_GIT_REPOSITORY"; else ln -s $WERCKER_SOURCE_DIR $GOPATH/src; fi
                if test "${WERCKER_GIT_REPOSITORY+set}" == set; then cp -R $WERCKER_SOURCE_DIR/* "$GOPATH/src/$WERCKER_GIT_DOMAIN/$WERCKER_GIT_OWNER/$WERCKER_GIT_REPOSITORY"; fi
                if test "${WERCKER_GIT_REPOSITORY+set}" == set; then export WERCKER_SOURCE_DIR="$GOPATH/src/$WERCKER_GIT_DOMAIN/$WERCKER_GIT_OWNER/$WERCKER_GIT_REPOSITORY"; fi
          - script:
              name: goapp get
              code: |
                cd $WERCKER_SOURCE_DIR
                goapp version
                goapp get ./...
          - script:
              name: goapp build
              code: |
                goapp build
          - script:
              name: goapp test
              code: |
                goapp test ./...
